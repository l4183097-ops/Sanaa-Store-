<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>

<style>
body{
font-family:Tajawal;
background:#f5f5f5;
padding:20px;
direction:rtl;
}
.box{
background:white;
padding:15px;
border-radius:12px;
max-width:400px;
margin:auto;
box-shadow:0 0 10px #0002;
}
input,button{
width:100%;
padding:10px;
margin:6px 0;
}
button{
background:#ff6b00;
color:white;
border:none;
border-radius:8px;
cursor:pointer;
}
</style>
</head>

<body>

<div class="box" id="loginBox">
<h3>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
<input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="box" id="adminBox" style="display:none">
<h3>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input id="category" placeholder="Ø§Ù„Ù‚Ø³Ù…">

<input type="file" id="image" accept="image/*">

<button onclick="addProduct()">Ø±ÙØ¹ Ø§Ù„Ù…Ù†ØªØ¬</button>
</div>

<script>

/* âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
const ADMIN_PASSWORD="1234"; // ØºÙŠØ±Ù‡Ø§
const TOKEN="PUT_TOKEN";
const REPO="USERNAME/REPO";

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
function login(){
if(pass.value===ADMIN_PASSWORD){
loginBox.style.display="none";
adminBox.style.display="block";
}else{
alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
}
}

/* ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© */
function toBase64(file){
return new Promise(resolve=>{
let reader=new FileReader();
reader.readAsDataURL(file);
reader.onload=()=>resolve(reader.result.split(',')[1]);
});
}

/* Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© */
async function uploadImage(base64,name){

let path="images/"+Date.now()+"_"+name;

await fetch(
`https://api.github.com/repos/${REPO}/contents/${path}`,
{
method:"PUT",
headers:{
Authorization:"token "+TOKEN,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"upload image",
content:base64
})
});

return path;
}

/* Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
async function getProducts(){

let res=await fetch(
`https://api.github.com/repos/${REPO}/contents/products.json`,
{headers:{Authorization:"token "+TOKEN}}
);

let data=await res.json();

return {
list:JSON.parse(atob(data.content)),
sha:data.sha
};
}

/* Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
async function saveProducts(list,sha){

await fetch(
`https://api.github.com/repos/${REPO}/contents/products.json`,
{
method:"PUT",
headers:{
Authorization:"token "+TOKEN,
"Content-Type":"application/json"
},
body:JSON.stringify({
message:"update products",
content:btoa(JSON.stringify(list,null,2)),
sha:sha
})
});
}

/* Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ */
async function addProduct(){

let file=image.files[0];
if(!file){
alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø©");
return;
}

let base64=await toBase64(file);
let imagePath=await uploadImage(base64,file.name);

let data=await getProducts();

data.list.push({
name:name.value,
price:price.value,
cat:category.value,
img:`https://raw.githubusercontent.com/${REPO}/main/${imagePath}`
});

await saveProducts(data.list,data.sha);

alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬");

}

</script>

</body>
</html>